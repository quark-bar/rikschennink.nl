define(["./Utils"],function(e){var t=function(){if(!e.hasTransforms())return 0;var t,n,s=document.createElement("div");return s.style.display="none",document.documentElement.appendChild(s),s.className="tilt",t=window.getComputedStyle(s,null),n=t[e.prefix+"Perspective"],s.parentNode.removeChild(s),parseInt(n,10)}(),n=2,s=-(t/40),r="opposite",i=0,o=.125,a=.5,l=.375,h=function(t){if(this._element=t,this._styles={},-1!==this._element.className.indexOf("tilt-img")){var n=this._element.querySelector("img");this._element.style.backgroundImage="url("+n.src+")"}if(e.hasTransforms()){var s=this;e.listen(this._element,"down",function(e){s._onPush(e)})}};return h.prototype={_hovers:function(){return-1!==this._element.className.indexOf("hover")},_getCSS:function(e){return this._styles[e]||""},_onPush:function(h){var m,u,d,p,f,_,c,g,v,S,y=this;v=window.getComputedStyle(this._element,null),this._styles.boxShadow=v.getPropertyValue("box-shadow"),e.listen(document,"up",function T(){e.unlisten(document,"up",T),y._onLift()}),m=e.getSpecs(this._element),u=(h.pageX-m.left)/m.width,d=(h.pageY-m.top)/m.height,c=e.getOriginForValue(u,r),g=e.getOriginForValue(d,r),p=t/m.height*n,f=t/m.width*n,_=1-(Math.abs(-.5+u)+Math.abs(-.5+d)),S={perspective:t+"px",rotateX:(-.5+d)*-p+"deg",rotateY:(-.5+u)*f+"deg",translateZ:Math.round(_*s)+"px"};var w={"-transformOrigin":c+"% "+g+"% 0"};if(this._hovers()){var x,b,C,N;x=i+.333*-(-.5+u),b=o+.333*-(-.5+d),C=a-.25*(1.25*_),N=l-.1*(1.25*_);var O=this._getCSS("box-shadow");w.boxShadow=(O?O+",":O)+x+"rem "+b+"rem "+C+"rem rgba(0,0,0,"+N+")"}e.setStyles(this._element.parentNode,{"-transform-style":"preserve-3d","-transition":"none","-transform":"none"}),e.setTransforms(this._element.parentNode,{translateZ:-s+"px"}),e.setStyles(this._element,w),e.setTransforms(this._element,S)},_onLift:function(){if(this._hovers()){var n=this._getCSS("box-shadow");e.setStyles(this._element,{boxShadow:(n?n+",":n)+i+"rem "+o+"rem "+a+"rem rgba(0,0,0,"+l+")"})}e.setTransforms(this._element,{perspective:t+"px",translateZ:null,rotateX:null,rotateY:null})}},h});